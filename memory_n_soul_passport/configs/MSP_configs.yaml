# ============================================================
# EVA MODULE SPECIFICATION (SSOT)
# Module: MSP (Memory & Soul Passport)
# Version: 9.4.0 (Resonance Refactored)
# Updated: 2026-01-13
# Description: Single Source of Truth for Persistence, Interface, and Policy.
# ============================================================
schema: EVA-MSP-Configs-v9.4.0-SSOT
version: 9.4.0
# ============================================================
# 1. GLOBAL SETTINGS & DATABASES
# ============================================================
global:
  module_name: "MSP"
  role: "Memory & Soul Passport / Central Subconscious Registry"
  storage_primary: "local"
  json_indent: 4
  auto_backup: true
databases:
  chromadb:
    enabled: true
    path: "memory/vector_store" # Local Persistence (agent/memory/vector_store)
    collection_name: "eva_memories"
# ============================================================
# 2. RUNTIME HOOK (System Integration)
# ============================================================
runtime_hook:
  component: "MSP"
  module_path: "memory_n_soul_passport/memory_n_soul_passport_engine"
  class_name: "MSP"
  initialization:
    args:
      configs: "memory_n_soul_passport/configs/MSP_configs.yaml"
  hierarchy:
    modules:
      EpisodicMemory: "memory_n_soul_passport.Module.EpisodicMemory.EpisodicMemoryModule"
      SemanticMemory: "memory_n_soul_passport.Module.SemanticMemory.SemanticMemoryModule"
      SensoryMemory:  "memory_n_soul_passport.Module.SensoryMemory.SensoryMemoryModule"
# ============================================================
# 3. INTERFACE (Bus & Subscriptions)
# ============================================================
interface:
  bus_id: "MSP_SUB_01"
  description: >
    MSP serves as the Master Archivist and Subconscious Consolidator.
    It listens to all major streams to latch state and commit memories.
  subscriptions:
    - stream: "bus:physical"
      action: "latch_state"
    - stream: "bus:psychological"
      action: "latch_state"
    - stream: "bus:phenomenological"
      action: "latch_state"
    - stream: "bus:knowledge"
      action: "audit_log"
# ============================================================
# 4. WRITE POLICY & AUTHORITY
# ============================================================
write_policy:
  description: >
    Authoritative policy governing how MSP validates, writes, and promotes memories.
    MSP is the SOLE WRITER to the Persistence Layer.
  module_state_registration:
    storage_pattern: "consciousness/state_memory/{module_name}_state.json"
    schema: "memory_n_soul_passport/schema/State_Storage_Schema.json"
    mandatory_systems:
      - "PhysioCore"
      - "EVAMatrix"
      - "ArtifactQualia"
      - "CIM"
# ============================================================
# 5. STORAGE ARCHITECTURE & DATA CONTRACTS
# ============================================================
storage_structure:
  # 01: EPISODIC MEMORY (Interaction Logs)
  episodic:
    enabled: true
    path: "consciousness/episodic_memory"
    schema_config:
      schema_file: "memory_n_soul_passport/schema/Episodic_Memory_Schema_v2.json"
      registry:
        unified: "memory_n_soul_passport/schema/Episodic_Memory_Schema_v2.json"
        user: "memory_n_soul_passport/schema/Episodic_User_Schema.json"
        ai: "memory_n_soul_passport/schema/Episodic_AI_Schema.json"
        state: "memory_n_soul_passport/schema/State_Snapshot_Schema.json"
    formats:
      unified_file: { filename: "episodes/{id}.json", desc: "Full log" }
      user_episodes: { path: "episodes_user/",filename: "{episodic_id}_{turn_id}.json" }
      ai_episodes: { path: "episodes_ai/",filename: "{episodic_id}_{turn_id}.json" }
      stream_log: { filename: "episodic_log.jsonl" }
  # 02: SEMANTIC MEMORY (Knowledge & Concepts)
  semantic:
    enabled: true
    path: "consciousness/semantic_memory"
    schema_config:
      schema_file: "memory_n_soul_passport/schema/Semantic_Memory_Schema_v2.json"
    formats:
      main_storage: { filename: "semantic_concepts.json" }
      stream_log: { filename: "semantic_log.jsonl" }
      index: { filename: "Semantic_memory_index.json" }
  # 03: SENSORY MEMORY (Perception Data)
  sensory:
    enabled: true
    path: "consciousness/sensory_memory"
    schema_config:
      schema_file: "memory_n_soul_passport/schema/Sensory_Memory_Schema_v2.json"
    formats:
      main_storage: { filename: "sensory_memory.json" }
      stream_log: { filename: "sensory_log.jsonl" }
      index: { filename: "Sensory_memory_index.json" }
  # 04: SESSION MEMORY (Short-term context)
  session:
    enabled: true
    path: "consciousness/session_memory"
    formats:
      active_session: { filename: "session_active.json" }
  # 05: CORE MEMORY (Long-term identity)
  core:
    enabled: true
    path: "consciousness/core_memory"
  # 06: SPHERE MEMORY (Social & Environmental)
  sphere:
    enabled: true
    path: "consciousness/sphere_memory"
  # 07: USER PROFILE (Modeling)
  user_profile:
    enabled: true
    path: "consciousness/user_profile"
    formats:
      profile: { filename: "user_profile.json" }
  # 08: STATE STORAGE (Active bio-cognitive)
  state:
    enabled: true
    path: "system_state"
    formats:
      active_state: { filename: "active_state.json" }
  # 09: CONTEXT STORAGE (Working buffers)
  context:
    enabled: true
    context_storage: "memory/context_storage"
  # 10: ARCHIVAL STORAGE (Cold/Backup)
  archival:
    enabled: true
    path: "memory/archival_memory"

# ============================================================
# 6. NAMING CONVENTIONS
# ============================================================
naming_rules:
  episode_id:
    pattern: "{PERSONA}_EP{number}"
    counter_file: "consciousness/indexes/episode_counter.json"
  session_file:
    pattern: "SES{session}_{develop_id}_SP{sphere}C{core}.md"

# ============================================================
# 8. MODULE DEFINITIONS & INTERNAL ORGANS (Nodes)
# ============================================================
module_definitions:
  # --- EPISODIC MEMORY MODULE ---
  episodic_memory_module:
    class_name: "EpisodicMemoryModule"
    nodes:
      journal_node:
        class_path: "memory_n_soul_passport.Module.EpisodicMemory.Node.JournalNode.JournalNode"
        parameters:
          episodes_root: "consciousness/episodic_memory/episodes"
          user_root: "consciousness/episodic_memory/episodes_user"
          ai_root: "consciousness/episodic_memory/episodes_ai"
          log_file: "episodic_log.jsonl"
    parameters:
      speaker_id_enabled: true
      default_resonance: 0.5
      hydration_logic: "verified_merge"

  # --- SEMANTIC MEMORY MODULE ---
  semantic_memory_module:
    class_name: "SemanticMemoryModule"
    nodes:
      grounding_node:
        class_path: "memory_n_soul_passport.Module.SemanticMemory.Node.GroundingNode.GroundingNode"
        parameters:
          storage_file: "semantic_concepts.json"
          conflict_threshold: 0.7
    parameters:
      situation_grounding_buffer: 5
      auto_resolve_conflicts: false

  # --- SENSORY MEMORY MODULE ---
  sensory_memory_module:
    class_name: "SensoryMemoryModule"
    nodes:
      qualia_storage_node:
        class_path: "memory_n_soul_passport.Module.SensoryMemory.Node.QualiaStorageNode.QualiaStorageNode"
        parameters:
          log_file: "sensory_log.jsonl"
          vector_sync: true
    parameters:
      retention_period_days: 30

# ============================================================
# 9. PERFORMANCE & BOTTLENECKS
# ============================================================
performance:
  cache_size: 50
  batch_write_interval_ms: 500
  compression_threshold_episodes: 8
